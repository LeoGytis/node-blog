<html lang="en">
  <%- include('../partials/head.ejs') %>
  <body>
    <%- include('../partials/nav.ejs') %>

    <div class="create-blog content">
      <h2>Edit the blog form</h2>
      <form id="editForm" action="/blogs/<%= blog._id %>" method="POST">
        <label for="title">Title:</label>
        <input
          type="text"
          id="title"
          name="title"
          value="<%= blog.title %>"
          required
        />

        <label for="snippet">Snippet:</label>
        <input
          type="text"
          id="snippet"
          name="snippet"
          value="<%= blog.snippet %>"
          required
        />

        <label for="body">Body:</label>
        <textarea id="body" name="body" required><%= blog.body %></textarea>

        <button type="submit">Update Blog</button>
      </form>
    </div>
    <%- include('../partials/footer.ejs') %>

    <script>
      const form = document.getElementById("editForm");

      form.addEventListener("submit", (e) => {
        e.preventDefault();

        const formData = new FormData(form);
        const id = "<%= blog._id %>";
        const endpoint = `/blogs/${id}`;

        fetch(endpoint, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            title: formData.get("title"),
            snippet: formData.get("snippet"),
            body: formData.get("body"),
          }),
        })
          .then((response) => {
            if (!response.ok) {
              console.error("Response status:", response.status);
              return response.json().then((err) => {
                console.error("Error details:", err);
              });
            }
            return response.json();
          })
          .then((data) => {
            if (data.redirect) {
              window.location.href = data.redirect;
            }
          })
          .catch((err) => {
            console.error("Fetch error:", err);
          });
      });
    </script>
  </body>
</html>
